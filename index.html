<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <title>Owl | Sign in</title>
    <link type="text/css" rel="stylesheet" href="./css/normalize.css">
    <link type="text/css" rel="stylesheet" href="./css/utilities.css">
    <link type="text/css" rel="stylesheet" href="./css/global.css">
    <link type="text/css" rel="stylesheet" href="./css/components/auth-form/auth-form.css">
    <link type="text/css" rel="stylesheet" href="./css/components/auth-form/title.css">
    <link type="text/css" rel="stylesheet" href="./css/components/auth-form/field.css">
    <link type="text/css" rel="stylesheet" href="./css/components/auth-form/input.css">
    <link type="text/css" rel="stylesheet" href="./css/components/auth-form/label.css">
    <link type="text/css" rel="stylesheet" href="./css/components/auth-form/error.css">
    <link type="text/css" rel="stylesheet" href="./css/components/auth-form/button-group.css">
    <link type="text/css" rel="stylesheet" href="./css/components/auth-form/submit.css">
    <link type="text/css" rel="stylesheet" href="./css/components/auth-form/icon.css">
    <link type="text/css" rel="stylesheet" href="./css/components/alert/alert.css">
    <link type="text/css" rel="stylesheet" href="./css/components/alert/close.css">
    <link type="text/css" rel="stylesheet" href="./css/components/footer/footer.css">
</head>

<body>

    <div id="wrapper">
        <main id="content" class="flex justify-center align-center" aria-label="Authorization form">
            <div class="auth relative container">
                <div class="auth-form-container owl_open">
                    <form id="auth-form" class="auth-form" action="/" method="GET" autocomplete="on">
                        <h1 class="auth-form__title mt-1">
                            <span style="color: #8d6a4c;">O</span>w<span style="color: #79d0e4;">l</span>
                        </h1>
                        <div class="auth-form__field">
                            <input id="email" class="auth-form__input" type="email" name="email" placeholder=""
                                required>
                            <label for="email" class="auth-form__label">Email</label>
                            <div class="auth-form__error" id="email-error"></div>
                        </div>
                        <div class="auth-form__field">
                            <input id="password" class="auth-form__input" type="password" name="password" placeholder=""
                                required aria-required="true">
                            <label for="password" class="auth-form__label">Password</label>
                            <button type="button" class="password-toggle" aria-label="Show password" tabindex="-1">
                                <img src="./img/eye-open.svg" alt="open" class="eye-icon eye-open"
                                    style="display: none;">
                                <img src="./img/eye-close.svg" alt="close" class="eye-icon eye-close"
                                    style="display: block;">
                            </button>

                            <div class="auth-form__error" id="password-error"></div>
                        </div>
                        <div class="auth-form__button-group">
                            <button class="auth-form__submit" type="submit" aria-label="Войти в систему">
                                Sign in
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
        <footer class="footer">
            <div class="footer-content container">
                <div class="social-links">
                    <a href="https://github.com/Anaylan" aria-label="Github" target="_blank" class="social-icon">
                        <img src="./img/github-mark.svg" alt="Github" width="100%" height="100%">
                    </a>
                    <a href="https://www.linkedin.com/in/alexanderskobelev/" target="_blank" aria-label="LinkedIn"
                        class="social-icon">
                        <img src="./img/InBug-Black.svg" alt="LinkedIn" width="100%" height="100%">
                    </a>
                </div>
                <div class="copyright">
                    © <span id="year"></span> Anaylan. All rights reserved.
                </div>
            </div>
        </footer>

    </div>

    <div class="alert alert_success" id="alert">
        <div class="alert__message">You're logged in</div>
        <button id="close-btn" class="alert__close" aria-label="Close notification">
            <svg viewBox="0 0 24 24">
                <path
                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
            </svg>
        </button>
    </div>


    <script src="./alert.js"></script>
    <script src="./validator.js"></script>
    <script>
        var pwdField = document.querySelector("#password");
        var authContainer = document.querySelector('.auth-form-container')
        pwdField.onfocus = (event) => pwdFocus();

        pwdField.onblur = (event) => {
            if (event.currentTarget.type === 'password') {
                pwdBlur();
            }
        };

        function pwdBlur() {
            authContainer.classList.replace('owl_close', 'owl_open');
        }

        function pwdFocus() {
            authContainer.classList.replace('owl_open', 'owl_close');
        }

        const switchPwdToggle = (event) => {
            if (!event?.currentTarget || !pwdField) return;

            const button = event.currentTarget;
            const isPassword = pwdField.type === 'password';

            pwdField.type = isPassword ? 'text' : 'password';

            const closedIcon = button.querySelector('.eye-close');
            const openIcon = button.querySelector('.eye-open');

            if (closedIcon && openIcon) {
                if (isPassword) {
                    closedIcon.style.display = 'none';
                    openIcon.style.display = 'block';
                    button.setAttribute('aria-label', 'Скрыть пароль');
                    pwdFocus();
                } else {
                    // Скрываем пароль - закрытый глаз  
                    openIcon.style.display = 'none';
                    closedIcon.style.display = 'block';
                    button.setAttribute('aria-label', 'Показать пароль');
                    pwdBlur();
                }
            }
        }

        document.querySelector("#year").textContent = new Date().getFullYear();

        document.addEventListener('DOMContentLoaded', function () {
            document.querySelector('.password-toggle').onclick = switchPwdToggle;
        });
    </script>
    <script>
        var form = document.querySelector('#auth-form');
        var alert = new Alert(document.querySelector('#alert'));

        form.onsubmit = (event) => {
            event.preventDefault();

            var validator = new StringValidator();
            validator.min(6);

            const formData = new FormData(form);
            const errors = new Map();

            for (const [key, value] of formData.entries()) {
                errors.set(key, validator.validate(value))
                console.log(key, value)
            }

            document.querySelectorAll('.auth-form__error').forEach(el => {
                el.textContent = '';
                el.classList.remove('auth-form__error_visible');
            });

            let hasErr = false;
            for (const [key, value] of errors.entries()) {
                if (value.length > 1) {
                    hasErr = true;
                    let field = document.getElementById(`${key}-error`);
                    field.textContent = value;
                    field.classList.add('auth-form__error_visible');
                }
            }

            if (!hasErr) {
                alert.show();
                form.reset();
            }
        }
    </script>
</body>

</html>